# 进程的描述和控制

## 2.2 进程的描述

### 2.2.1 进程的定义和特征

#### 1. 进程的定义

 1. 进程控制块（Process Control Block,PCB)

    ​	描述进程的基本情况和互动过程，进而控制和管理进程

2. 进程实体（又称进程映像）
   + 进程实体简称进程
   + 由程序段、相关的数据段和PCB三部分构成
3. 较典型的定义
   1. 进程是程序的而一次执行
   2. 进程是一个程序机器数据在处理机上顺序执行时所发生的活动
   3. 进程是具有独立功能的程序在一个数据集合运行的过程，它是系统进行资源分配和调度的一个独立单位

#### 2. 进程的特征

1. 进程具有程序所没有的PCB结构
2. 动态性：进程的最基本的特征
3. 并发性
4. 独立性
5. 异步性

### 2.2.2 进程的基本状态及转换

#### 1. 进程的三种基本状态

1. 就绪（Ready）状态
   + 分配到除CPU以外的所有必要资源
2. 执行（Running）状态
   + 获得CPU
3. 阻塞（Block）状态
   + 由于发送某事件暂时无法继续执行的状态
   + OS把处理机分配给另一个就绪进程，而让受阻进程处于暂停状态

#### 2. 三种基本状态的转换

![image-20201129103637291](https://gitee.com/pengjae/pic/raw/master/img/20201129103644.png)

	#### 3. 创建状态和终止状态

1. 变成五种基本状态

2. 五种基本状态转换

   ![image-20201129103922936](https://gitee.com/pengjae/pic/raw/master/img/20201129103922.png)

   ### 2.2.3 挂起操作和进程状态的转换

1. 此时进程处于静止状态。如果进程正在执行，它将暂停执行。
   
   1. 原本处于就绪状态，则该进程此时暂不接受调度

#### 挂起操作的引入

>  挂起的原语**Suspend**  

1. 终端用户的需求
2. 父进程请求
3. 符合调节的需要
4. 操作系统的需要

#### 引入挂起操作后三个进程状态的转换

> 激活原语 Active

+ 活动就绪——>静止就绪
+ 静止就绪——>活动就绪
+ 活动阻塞——>静止阻塞
+ 静止阻塞——>活动阻塞

![image-20201129105056625](https://gitee.com/pengjae/pic/raw/master/img/20201129105140.png)

#### 引入挂起操作后五个进程状态的转换

1. 一个新进程产生时，该进程处于创建状态
   + null——>创建：
   + 创建——>活动就绪
   + 创建——>静止就绪
   + 执行——>终止



![image-20201129105107856](https://gitee.com/pengjae/pic/raw/master/img/20201129105107.png)

### 2.2.4 进程管理中的数据结构

#### 1 操作系统中用于管理控制的数据结构

1. 内存表、设备表、文件表和用于进程管理的进程表
2. 进程表又被称为进程控制块PCB

#### 2 进程控制块PCB的作用

1. PCB的作用是使一个在多道程序环境下不能独立运行的程序(含数据)成为一个能独立运行的基本单位，一个能与其他进程并发执行的进程。
2. 作为独立运行的基本单位的标志
3. 能实现间断性运行方式
4. 提供进程管理所需要的信息
5. 提供进程调度所需要的信息

#### 3 进程控制块中的信息

1. 进程标识符

   + 外部标识符
   + 内部标识符

   

## 2.4 进程同步

#### 同步机制应遵循的规则

1. 空闲让进
2. 忙则等待
3. 有限等待
4. 让权等待

### 2.4.3 信号量机制

1. 整型信号量

   ![image-20201129115210159](https://gitee.com/pengjae/pic/raw/master/img/20201129115210.png)

   > wait是拿货的意思 while的意思是如果没货就一直等 signal就是造货的意思

2. 记录型信号量

   ![image-20201129115327176](https://gitee.com/pengjae/pic/raw/master/img/20201129115327.png)

   ![image-20201129115338624](https://gitee.com/pengjae/pic/raw/master/img/20201129115338.png)

   3. AND型信号量

      ![image-20201129115405056](https://gitee.com/pengjae/pic/raw/master/img/20201129115405.png)

### 2.4.5 管程的定义

#### 管程：

+ 进程同步工具。
+ 代表共享资源的数据结构以及由对该共享数据结构实施操作的一组过程所组成的资源管理程序共同构成了一个操作系统的资源管理模块,我们称之为管程。
+ ​                (a)   一个管程定义了一个数据结构和能为并发进程所执行的一组操作，这组操作能同步进程和管程中的数据



## 2.5经典进程同步问题

### 2.5.1 生产者-消费者问题

#### 1利用记录型信号量解决生产者消费者问题

![image-20201129140320953](https://gitee.com/pengjae/pic/raw/master/img/20201129140320.png)



### 2.5.1 哲学家进餐问题

![image-20201129140345693](https://gitee.com/pengjae/pic/raw/master/img/20201129140345.png)

## 2.7 线程（Thread）的基本概念

### 2.7.1 线程的引入

1. ##### 为了减少程序在并发执行时间所付出的时空开销，使OS具有更好的并发性

2. 进程的两个基本属性

   1. 进程是一个可拥有资源的独立单位
   2. 进程同时又是一个可独立调度和分派的基本单位
   3. 每个进程在系统中有唯一的PCB

3. 程序并发执行所需付出的时空开销

4. 线程——作为调度和分派的基本单位

   1. 减少系统开销

### 2.7.2 线程和进程的比较

1. 调度的基本单位：
   1. 同为基本单位；
   2. 线程的切换代价远小于进程切换代价
2. 并发性
   1. 线程并发性大于进程
   2. 一个进程中的所有线程都能并发执行
3. 拥有资源
   1. 线程本身不拥有系统资源。而是仅有一点能保证独立运行的资源
   2. 线程资源小于进程资源
4. 独立性
   1. 在同一进程中的不同线程的独立性要比不同进程之间的独立性低得多
   2. 原因：同一进程的不同线程往往是为了提高并发性以及相互之间的合作而创建的
5. 系统开销
   1. 线程小于进程
6. 支持多处理机系统
   1. 一个进程中的多个线程分配到多个处理机上，使他们并发执行

### 2.7.3 线程的状态和线程控制块

#### 线程运行的三个状态

1. 执行状态
2. 就绪状态
3. 阻塞状态

#### 多线程OS中的进程属性

1. 进程是一个可拥有资源的基本单位
2. 多个线程可并发执行
3. 进程已不是可执行的实体

## 2.8线程的实现

### 2.8.1 线程的实现方式

1. 内核支持线程KST( Kernel Supported Threads)

   四个主要优点：

   1. 在多处理器系统中，内核能够同时调度同一进程中的多个线程并行执行
   2. 如果进程中的一个线程被阻塞了，内核可以调度该进程中的其他线程占有处理器运行，也可以运行其他进程中的线程
   3. 支持现场具有很小的数据结构和堆栈
   4. 内核本身采用多线程技术

2. 用户级线程
   优点

   1. 线程切换不需要转换到内核空间
   2. 调度算法可以是进程专用的
   3. 用户级线程的实现与OS平台无关

   缺点：

   1. 系统调用的阻塞问题
   2. 进程中仅有一个线程能执行

   

